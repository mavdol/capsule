
package capsule:host;

interface api {

    variant task-error {
        invalid-name(string),
        invalid-config(string),
        invalid-args(string),
        internal-error(string),
    }

    schedule-task: func(
        task-name: string,
        args-json: string,
        config-json: string
    ) -> result<string, task-error>;

    record http-response {
        status: u16,
        headers: list<tuple<string, string>>,
        body: string,
    }

    variant http-error {
        network-error(string),
        timeout(string),
        invalid-url(string),
    }

    http-request: func(
        method: string,
        url: string,
        headers: list<tuple<string, string>>,
        body: option<string>
    ) -> result<http-response, http-error>;
}

interface task-runner {
    run: func(args-json: string) -> result<string, string>;
}

world capsule-agent {
    import api;
    export task-runner;
}
